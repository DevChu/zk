<window viewModel="@id('vm') @init('org.zkoss.clientbind.test.mvvm.book.basic.CollectionTemplateGridVM')">
	<label id="msg" value="@bind(vm.message1)"/>
	<grid id="outergrid" hflex="1"
		  model="@bind(vm.items) @template(each.name eq 'A' or forEachStatus.index eq 2?'model1':'model2')">
		<custom-attributes org.zkoss.zul.grid.rod="true"/>
		<columns>
			<column label="index" hflex="1"/>
			<column label="name" hflex="1"/>
			<column label="options" hflex="2"/>
			<column label="action" hflex="2"/>
			<column label="template" hflex="1"/>
		</columns>

		<template name="model1" var="item" status="s">
			<row>
				<label value="@load(s.index)"/>
				<label value="@bind(item.name)"/>
				<grid hflex="1" model="@bind(item.options) @template('model1')">
					<columns>
						<column label="index"/>
						<column label="previous-index"/>
						<column label="name"/>
					</columns>
					<template name="model1" var="option">
						<row>
							<label value="@bind(optionStatus.index)"/>
							<label value="@bind(s.index)"/>
							<label value="@bind(option)"/>
						</row>
					</template>
				</grid>
				<hlayout>
					<button label="Index" onClick="@command('showIndex', index=s.index)"/>
					<button label="Delete" onClick="@command('delete', item=item)"/>
					<button label="Add After" onClick="@command('addAfter', item=item)"/>
					<button label="Add Before" onClick="@command('addBefore', item=item)"/>
				</hlayout>
				<label value="Model1"/>
			</row>
		</template>
		<template name="model2" var="item" status="s">
			<row>
				<label value="@bind(s.index)"/>
				<label value="@bind(item.name)"/>
				<grid hflex="1" model="@bind(item.options) @template('model1')">
					<columns>
						<column label="index"/>
						<column label="previous-index"/>
						<column label="name"/>
					</columns>
					<template name="model1" var="option">
						<row>
							<label value="@bind(optionStatus.index)"/>
							<label value="@bind(s.index)"/>
							<label value="@bind(option)"/>
						</row>
					</template>
				</grid>
				<hbox>
					<button label="Index" onClick="@command('showIndex', index=s.index)"/>
					<button label="Delete" onClick="@command('delete', item=item)"/>
					<button label="Add After" onClick="@command('addAfter', item=item)"/>
					<button label="Add Before" onClick="@command('addBefore', item=item)"/>
				</hbox>
				<label value="Model2"/>
			</row>
		</template>
	</grid>

	<hbox>
		<button label="reload" onClick="@command('reload')"/>
		<button id="chgBtn1" label="change1" onClick="@command('change1')"/>
		<button id="chgBtn2" label="change2" onClick="@command('change2')"/>
		<button label="detach" onClick="grid.detach()"/>
		<button label="Dump" onClick="binder.getTracker().dump()"/>
		<button label="remove0" onClick="@command('delete0')"/>
		<button label="change0" onClick="@command('change0')"/>
		<button label="add0" onClick="@command('add0')"/>
	</hbox>
</window>